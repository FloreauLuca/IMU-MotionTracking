<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <script>

        var chart = null;      
        var data = [];
        var graphNames = [];
        const isObject = (obj) => {
            return Object.prototype.toString.call(obj) === '[object Object]';
        };

        window.onload = function() {
            resetChart();
                                                           
            //$.getJSON("../Assets/Graph/new-json-graph-test.graph", callback);           
        };  
        function resetChart()
        {
            data = []; 
            chart = new CanvasJS.Chart("chartContainer",
                {
                    theme: "light2",
                    exportEnabled: true,
                    animationEnabled: true,
                    zoomEnabled: true,      
                    zoomType: "xy",
                    title: {
                        text: "Accelerometer data"
                    }, 
                    data: data,
                    axisY: {
                        includeZero: false
                    }
                });
        }
        function drawGraph() {
            console.log(data);
            var text = document.getElementById("data").value;
            //console.log(x);                                                
            var json = JSON.parse(text);
            //Object.keys(json).forEach(key => {
            //    console.log(key, json[key]);
            //});
            generatedCheckBox(json);
            writeToDataPoint(json);

        }
        function createCheckbox(name) {
            var myDiv = document.getElementById("checkboxContainer");

            // creating checkbox element
            var checkbox = document.createElement('input');

            // Assigning the attributes
            // to created checkbox
            checkbox.type = "checkbox";
            checkbox.name = name;
            checkbox.value = "value";
            checkbox.checked = false;
            checkbox.id = name;

            // creating label for checkbox
            var label = document.createElement('label');

            // assigning attributes for
            // the created label tag
            label.htmlFor = name;

            // appending the created text to
            // the created label tag
            label.appendChild(document.createTextNode(name));

            // appending the checkbox
            // and label to div
            myDiv.appendChild(checkbox);
            myDiv.appendChild(label);
            return checkbox;
        } 
        function generatedCheckBox(json) {
            Object.keys(json.frames[0]).forEach(key => {
                var checkbox = document.getElementById(key);
                if (!checkbox) {
                    checkbox = createCheckbox(key);
                    graphNames.push(key);
                }                
            });
        }
        function writeToDataPoint(json) {    
            graphNames.forEach(key => {      
                console.log(key);
                var checkbox = document.getElementById(key);
                if (!checkbox) {
                    checkbox = createCheckbox(key);
                }
                var checked = checkbox.checked;
                var dataPoints;
                if (json.frames[0][key] == undefined) {
                    var axis = "X";
                    if (data.find(data_ => data_.name == key + axis) != undefined) {
                        var obj = data.find(data_ => data_.name == key + axis);   
                        obj.visible = checked;
                    }
                    axis = "Y";
                    if (data.find(data_ => data_.name == key + axis) != undefined) {
                        var obj = data.find(data_ => data_.name == key + axis);
                        obj.visible = checked;
                    }
                    axis = "Z";
                    if (data.find(data_ => data_.name == key + axis) != undefined) {
                        var obj = data.find(data_ => data_.name == key + axis);
                        obj.visible = checked;
                    }
                    if (data.find(data_ => data_.name == key) != undefined) {
                        var obj = data.find(data_ => data_.name == key); 
                        obj.visible = checked;

                    }
                    return;
                }                     
                if (isObject(json.frames[0][key]) && json.frames[0][key].x != undefined) {
                    dataPoints = {};
                    dataPoints["X"] = [];
                    dataPoints["Y"] = [];
                    dataPoints["Z"] = [];
                    for (var i = 0; i < json.frames.length; i++) {
                        dataPoints["X"] .push({
                            x: json.frames[i].dt,
                            y: json.frames[i][key].x
                        });
                        dataPoints["Y"].push({
                            x: json.frames[i].dt,
                            y: json.frames[i][key].y
                        });
                        dataPoints["Z"].push({
                            x: json.frames[i].dt,
                            y: json.frames[i][key].z
                        });
                    }    
                    function addAxisData(axis, colorAxis) {
                        console.log(key + axis);
                        if (data.find(data_ => data_.name == key + axis) != undefined) {
                            var obj = data.find(data_ => data_.name == key + axis);
                            obj.dataPoints = dataPoints[axis];    
                            obj.visible = checked;
                        } else {                                    
                            data.push({
                                type: "line",
                                showInLegend: true,
                                visible: checked,
                                name: key + axis,
                                color: colorAxis,
                                dataPoints: dataPoints[axis]
                            });                
                        }   
                    }

                    console.log(data);
                    addAxisData("X", "red");
                    addAxisData("Y", "green");
                    addAxisData("Z", "blue");  

                } else {
                    dataPoints = [];
                    for (var i = 0; i < json.frames.length; i++) {
                        dataPoints.push({
                            x: json.frames[i].dt,
                            y: json.frames[i][key]
                        });
                    }
                    if (data.find(data_ => data_.name == key) != undefined) {
                        var obj = data.find(data_ => data_.name == key);
                        obj.dataPoints = dataPoints;
                        obj.visible = checked;

                    } else {                                         
                        data.push({
                            type: "line",
                            showInLegend: true,
                            visible: checked,
                            name: key,     
                            dataPoints: dataPoints
                        });                   
                    }                 
                }
            });                                              
            console.log(data);
            chart.render();
        }     
    </script>
</head>
<body>
    <br />
    <textarea id="data" rows="10" cols="100"> </textarea>
    <br />
    <button type="button" onclick="drawGraph()">Update Graph</button>
    <div id="checkboxContainer"></div>
<div id="chartContainer" style="height: 500px; max-width: 920px; margin: 0px auto;"></div>
    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="canvasjs.min.js"></script>
</body>
</html>